"use strict";(self.webpackChunkelement_web=self.webpackChunkelement_web||[]).push([[230],{"./node_modules/matrix-react-sdk/res/img/element-icons/cancel-rounded.svg":(e,t,o)=>{o.d(t,{J:()=>i});var s,n=o("./node_modules/react/index.js");function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s])}return e},a.apply(this,arguments)}function r(e,t){return n.createElement("svg",a({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 10 10",role:"presentation","aria-hidden":!0,ref:t},e),s||(s=n.createElement("path",{d:"M1 1l8 8M9.001 1l-8 8",stroke:"currentColor",strokeWidth:1.6,strokeLinecap:"round"})))}var i=n.forwardRef(r)},"./node_modules/matrix-react-sdk/src/components/views/rooms/CollapsibleButton.tsx":(e,t,o)=>{o.d(t,{A:()=>u});var s=o("./node_modules/@babel/runtime/helpers/esm/extends.js"),n=o("./node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js"),a=o("./node_modules/react/index.js"),r=o("./node_modules/classnames/index.js"),i=o.n(r),l=o("./node_modules/matrix-react-sdk/src/components/views/elements/AccessibleTooltipButton.tsx"),c=o("./node_modules/matrix-react-sdk/src/components/views/rooms/MessageComposerButtons.tsx"),m=o("./node_modules/matrix-react-sdk/src/components/views/context_menus/IconizedContextMenu.tsx");const d=["title","children","className","iconClassName","inputRef"],u=e=>{let{title:t,children:o,className:r,iconClassName:u,inputRef:_}=e,p=(0,n.Z)(e,d);return!!(0,a.useContext)(c.jH)?a.createElement(m.$k,(0,s.Z)({},p,{iconClassName:u,label:t,inputRef:_})):a.createElement(l.Z,(0,s.Z)({},p,{title:t,className:i()(r,u),ref:_}),o)}},"./node_modules/matrix-react-sdk/src/components/views/rooms/EmojiButton.tsx":(e,t,o)=>{o.d(t,{K:()=>u});var s=o("./node_modules/@babel/runtime/helpers/esm/extends.js"),n=o("./node_modules/classnames/index.js"),a=o.n(n),r=o("./node_modules/react/index.js"),i=o("./node_modules/matrix-react-sdk/src/languageHandler.tsx"),l=o("./node_modules/matrix-react-sdk/src/components/structures/ContextMenu.tsx"),c=o("./node_modules/matrix-react-sdk/src/components/views/emojipicker/EmojiPicker.tsx"),m=o("./node_modules/matrix-react-sdk/src/components/views/rooms/CollapsibleButton.tsx"),d=o("./node_modules/matrix-react-sdk/src/components/views/rooms/MessageComposerButtons.tsx");function u({addEmoji:e,menuPosition:t,className:o}){const n=(0,r.useContext)(d.jH),[u,_,p,h]=(0,l.av)();let x=null;if(u&&_.current){const o=null!=t?t:(0,l.LS)(_.current.getBoundingClientRect()),a=()=>{h(),null==n||n()};x=r.createElement(l.ZP,(0,s.Z)({},o,{onFinished:a,managed:!1}),r.createElement(c.ZP,{onChoose:e,onFinished:a}))}const g=a()("mx_EmojiButton",o,{mx_EmojiButton_highlight:u});return r.createElement(r.Fragment,null,r.createElement(m.A,{className:g,iconClassName:"mx_EmojiButton_icon",onClick:p,title:(0,i._t)("common|emoji"),inputRef:_}),x)}},"./node_modules/matrix-react-sdk/src/components/views/rooms/MessageComposerButtons.tsx":(e,t,o)=>{o.d(t,{jH:()=>xe,ZP:()=>Ne});var s=o("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),n=o("./node_modules/@babel/runtime/helpers/esm/extends.js"),a=o("./node_modules/classnames/index.js"),r=o.n(a),i=o("./node_modules/matrix-js-sdk/src/matrix.ts"),l=o("./node_modules/react/index.js"),c=o("./node_modules/matrix-react-sdk/src/languageHandler.tsx"),m=o("./node_modules/matrix-react-sdk/src/components/views/elements/AccessibleTooltipButton.tsx"),d=o("./node_modules/matrix-react-sdk/src/components/views/rooms/CollapsibleButton.tsx"),u=o("./node_modules/matrix-react-sdk/src/dispatcher/dispatcher.ts"),_=o("./node_modules/matrix-react-sdk/src/components/views/dialogs/ErrorDialog.tsx"),p=o("./node_modules/matrix-react-sdk/src/components/structures/ContextMenu.tsx"),h=o("./node_modules/matrix-react-sdk/src/contexts/MatrixClientContext.tsx"),x=o("./node_modules/maplibre-gl/dist/maplibre-gl.js"),g=o.n(x),v=o("./node_modules/matrix-js-sdk/src/logger.ts"),k=o("./node_modules/matrix-react-sdk/src/Modal.tsx"),C=o("./node_modules/matrix-react-sdk/src/utils/WellKnownUtils.ts"),E=o("./node_modules/matrix-react-sdk/src/utils/beacon/index.ts"),y=o("./node_modules/matrix-react-sdk/src/utils/location/index.ts"),b=o("./node_modules/matrix-react-sdk/src/components/views/elements/AccessibleButton.tsx"),f=o("./node_modules/matrix-react-sdk/src/components/views/location/MapError.tsx"),w=o("./node_modules/matrix-react-sdk/src/DateUtils.ts"),P=o("./node_modules/matrix-react-sdk/src/components/views/elements/Dropdown.tsx");const S={fifteenMins:9e5,oneHour:36e5,eightHours:288e5},M=S.fifteenMins,N=e=>(0,c._t)("location_sharing|live_share_button",{duration:(0,w.LU)(e)}),L=({timeout:e,onChange:t})=>{const o=Object.values(S).map((e=>({key:e.toString(),duration:e,label:N(e)})));Object.values(S).includes(e)||o.push({key:e.toString(),duration:e,label:N(e)});return l.createElement(P.Z,{id:"live-duration",label:N(e),value:e.toString(),onOptionChange:e=>{t(+e)},className:"mx_LiveDurationDropdown"},o.map((({key:e,label:t})=>l.createElement("div",{key:e},t))))};var Z=o("./node_modules/matrix-react-sdk/src/components/views/dialogs/QuestionDialog.tsx"),T=o("./node_modules/matrix-react-sdk/src/SdkConfig.ts"),B=o("./node_modules/matrix-react-sdk/src/stores/OwnBeaconStore.ts"),U=o("./node_modules/matrix-react-sdk/src/utils/local-room.ts");let I=function(e){return e.Own="Own",e.Pin="Pin",e.Live="Live",e}({});const j=(e,t,o)=>{const{modalParams:s,errorMessage:n}="M_FORBIDDEN"===e.errcode?(e=>{const t=e===I.Live?"Insufficient permissions to start sharing your live location":"Insufficient permissions to send your location";return{modalParams:{title:(0,c._t)("location_sharing|error_no_perms_title"),description:(0,c._t)("location_sharing|error_no_perms_description"),button:(0,c._t)("action|ok"),hasCancelButton:!1,onFinished:()=>{}},errorMessage:t}})(o):((e,t)=>{const o=e===I.Live?"We couldn't start sharing your live location":"We couldn't send your location";return{modalParams:{title:(0,c._t)("location_sharing|error_send_title"),description:(0,c._t)("location_sharing|error_send_description",{brand:T.ZP.get().brand}),button:(0,c._t)("action|try_again"),cancelButton:(0,c._t)("action|cancel"),onFinished:e=>{e&&t()}},errorMessage:o}})(o,t);v.k.error(n,e),k.ZP.createDialog(Z.Z,s)};var A=o("./node_modules/matrix-react-sdk/src/components/views/location/Marker.tsx");const R=e=>e===I.Own||e===I.Live;class O extends l.Component{constructor(e){super(e),(0,s.Z)(this,"context",void 0),(0,s.Z)(this,"map",void 0),(0,s.Z)(this,"geolocate",void 0),(0,s.Z)(this,"marker",void 0),(0,s.Z)(this,"getMarkerId",(()=>"mx_MLocationPicker_marker")),(0,s.Z)(this,"addMarkerToMap",(()=>{var e;this.marker=new(g().Marker)({element:null!==(e=document.getElementById(this.getMarkerId()))&&void 0!==e?e:void 0,anchor:"bottom",offset:[0,-1]}).setLngLat(new(g().LngLat)(0,0)).addTo(this.map)})),(0,s.Z)(this,"updateStyleUrl",(e=>{var t;const o=null===(t=(0,C.Td)(e))||void 0===t?void 0:t.map_style_url;var s;o&&(null===(s=this.map)||void 0===s||s.setStyle(o))})),(0,s.Z)(this,"onGeolocate",(e=>{var t;this.marker||this.addMarkerToMap(),this.setState({position:(0,E.GJ)(e)}),null===(t=this.marker)||void 0===t||t.setLngLat(new(g().LngLat)(e.coords.longitude,e.coords.latitude))})),(0,s.Z)(this,"onClick",(e=>{var t;this.marker||this.addMarkerToMap(),null===(t=this.marker)||void 0===t||t.setLngLat(e.lngLat),this.setState({position:{timestamp:Date.now(),latitude:e.lngLat.lat,longitude:e.lngLat.lng}})})),(0,s.Z)(this,"onGeolocateError",(e=>{var t;(v.k.error("Could not fetch location",e),R(this.props.shareType)&&(this.props.onFinished(),k.ZP.createDialog(_.Z,{title:(0,c._t)("location_sharing|error_fetch_location"),description:(0,y.rl)(e.code)})),this.geolocate)&&(null===(t=this.map)||void 0===t||t.removeControl(this.geolocate))})),(0,s.Z)(this,"onTimeoutChange",(e=>{this.setState({timeout:e})})),(0,s.Z)(this,"onOk",(()=>{const{timeout:e,position:t}=this.state;this.props.onChoose(t?{uri:(0,E.zb)(t),timestamp:t.timestamp,timeout:e}:{timeout:e}),this.props.onFinished()})),this.state={position:void 0,timeout:M,error:void 0}}componentDidMount(){this.context.on(i.ClientEvent.ClientWellKnown,this.updateStyleUrl);try{if(this.map=new(g().Map)({container:"mx_LocationPicker_map",style:(0,y.yE)(this.context),center:[0,0],zoom:1}),this.geolocate=new(g().GeolocateControl)({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!1}),this.map.addControl(this.geolocate),this.map.on("error",(e=>{v.k.error("Failed to load map: check map_style_url in config.json has a valid URL and API key",e.error),this.setState({error:y.Ti.MapStyleUrlNotReachable})})),this.map.on("load",(()=>{var e;null===(e=this.geolocate)||void 0===e||e.trigger()})),this.geolocate.on("error",this.onGeolocateError),R(this.props.shareType)&&this.geolocate.on("geolocate",this.onGeolocate),this.props.shareType===I.Pin){const e=new(g().NavigationControl)({showCompass:!1,showZoom:!0});this.map.addControl(e,"bottom-right"),this.map.on("click",this.onClick)}}catch(e){v.k.error("Failed to render map",e);const t=null==e?void 0:e.message;let o;o=t===y.Ti.MapStyleUrlNotConfigured?y.Ti.MapStyleUrlNotConfigured:t.includes("Failed to initialize WebGL")?y.Ti.WebGLNotEnabled:y.Ti.Default,this.setState({error:o})}}componentWillUnmount(){var e,t,o;null===(e=this.geolocate)||void 0===e||e.off("error",this.onGeolocateError),null===(t=this.geolocate)||void 0===t||t.off("geolocate",this.onGeolocate),null===(o=this.map)||void 0===o||o.off("click",this.onClick),this.context.off(i.ClientEvent.ClientWellKnown,this.updateStyleUrl)}render(){return this.state.error?l.createElement("div",{className:"mx_LocationPicker mx_LocationPicker_hasError"},l.createElement(f.e,{error:this.state.error,onFinished:this.props.onFinished})):l.createElement("div",{className:"mx_LocationPicker"},l.createElement("div",{id:"mx_LocationPicker_map"}),this.props.shareType===I.Pin&&l.createElement("div",{className:"mx_LocationPicker_pinText"},l.createElement("span",null,this.state.position?(0,c._t)("location_sharing|click_move_pin"):(0,c._t)("location_sharing|click_drop_pin"))),l.createElement("div",{className:"mx_LocationPicker_footer"},l.createElement("form",{onSubmit:this.onOk},this.props.shareType===I.Live&&l.createElement(L,{onChange:this.onTimeoutChange,timeout:this.state.timeout}),l.createElement(b.Z,{type:"submit",element:"button",kind:"primary",className:"mx_LocationPicker_submitButton",disabled:!this.state.position,onClick:this.onOk},(0,c._t)("location_sharing|share_button")))),l.createElement("div",{id:this.getMarkerId()},!!this.marker&&l.createElement(A.Z,{roomMember:R(this.props.shareType)?this.props.sender:void 0,useMemberColor:this.props.shareType===I.Live})))}}(0,s.Z)(O,"contextType",h.ZP);const D=O;var F=o("./node_modules/matrix-react-sdk/src/settings/SettingsStore.ts"),H=o("./node_modules/matrix-react-sdk/res/img/element-icons/caret-left.svg"),G=o("./node_modules/matrix-react-sdk/res/img/element-icons/cancel-rounded.svg");const W=({onBack:e,onCancel:t,displayBack:o})=>l.createElement("div",{className:"mx_ShareDialogButtons"},o&&l.createElement(b.Z,{className:"mx_ShareDialogButtons_button left","aria-label":(0,c._t)("action|back"),onClick:e,element:"button"},l.createElement(H.J,{className:"mx_ShareDialogButtons_button-icon"})),l.createElement(b.Z,{className:"mx_ShareDialogButtons_button right","aria-label":(0,c._t)("action|close"),onClick:t,element:"button"},l.createElement(G.J,{className:"mx_ShareDialogButtons_button-icon"})));var z=o("./node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js"),J=o("./node_modules/matrix-react-sdk/src/stores/OwnProfileStore.ts"),K=o("./node_modules/matrix-react-sdk/src/components/views/avatars/BaseAvatar.tsx"),V=o("./node_modules/matrix-react-sdk/src/components/views/typography/Heading.tsx"),$=o("./node_modules/matrix-react-sdk/res/img/element-icons/location.svg"),q=o("./node_modules/matrix-react-sdk/src/components/views/beacon/StyledLiveBeaconIcon.tsx");const Y=["onClick","label","shareType"],Q=()=>{var e,t;const o=(0,l.useContext)(h.ZP).getSafeUserId(),s=null!==(e=J.p.instance.displayName)&&void 0!==e?e:void 0,n="36px",a=null!==(t=J.p.instance.getHttpAvatarUrl(parseInt(n,10)))&&void 0!==t?t:void 0;return l.createElement("div",{className:`mx_ShareType_option-icon ${I.Own}`},l.createElement(K.Z,{idName:o,name:s,url:a,size:n,className:"mx_UserMenu_userAvatar_BaseAvatar"}))},X=e=>{let{onClick:t,label:o,shareType:s}=e,a=(0,z.Z)(e,Y);return l.createElement(b.Z,(0,n.Z)({element:"button",className:"mx_ShareType_option",onClick:null!=t?t:null},a),s===I.Own&&l.createElement(Q,null),s===I.Pin&&l.createElement($.J,{className:`mx_ShareType_option-icon ${I.Pin}`}),s===I.Live&&l.createElement(q.Z,{className:`mx_ShareType_option-icon ${I.Live}`}),o)},ee=({setShareType:e,enabledShareTypes:t})=>{const o={[I.Own]:(0,c._t)("location_sharing|share_type_own"),[I.Live]:(0,c._t)("location_sharing|share_type_live"),[I.Pin]:(0,c._t)("location_sharing|share_type_pin")};return l.createElement("div",{className:"mx_ShareType"},l.createElement($.J,{className:"mx_ShareType_badge"}),l.createElement(V.Z,{className:"mx_ShareType_heading",size:"3"},(0,c._t)("location_sharing|share_type_prompt")),l.createElement("div",{className:"mx_ShareType_wrapper_options"},t.map((t=>l.createElement(X,{key:t,onClick:()=>e(t),label:o[t],shareType:t})))))};var te=o("./node_modules/matrix-react-sdk/src/components/views/elements/LabelledToggleSwitch.tsx");const oe=({onSubmit:e})=>{const[t,o]=(0,l.useState)(!1);return l.createElement("div",{className:"mx_EnableLiveShare"},l.createElement(q.Z,{className:"mx_EnableLiveShare_icon"}),l.createElement(V.Z,{className:"mx_EnableLiveShare_heading",size:"3"},(0,c._t)("location_sharing|live_enable_heading")),l.createElement("p",{className:"mx_EnableLiveShare_description"},(0,c._t)("location_sharing|live_enable_description")),l.createElement(te.Z,{value:t,onChange:o,label:(0,c._t)("location_sharing|live_toggle_label")}),l.createElement(b.Z,{className:"mx_EnableLiveShare_button",element:"button",kind:"primary",onClick:e,disabled:!t},(0,c._t)("action|ok")))};var se=o("./node_modules/matrix-react-sdk/src/hooks/useSettings.ts"),ne=o("./node_modules/matrix-react-sdk/src/settings/SettingLevel.ts");const ae=({menuPosition:e,onFinished:t,sender:o,roomId:s,openMenu:a,relation:r})=>{const m=(0,l.useContext)(h.ZP),d=(e=>{const t=[I.Own];return e||t.push(I.Live),t.push(I.Pin),t})(r),u=(0,se.n)("feature_location_share_live"),_=d.length>1,[x,g]=(0,l.useState)(_?void 0:I.Own),v=J.p.instance.displayName,k=m.getSafeUserId(),C=x===I.Live?((e,t,o,s)=>async({timeout:e})=>{const n=(0,c._t)("location_sharing|live_description",{displayName:o});try{await B.d.instance.createLiveBeacon(t,i.ContentHelpers.makeBeaconInfoContent(null!=e?e:3e5,!0,n,i.LocationAssetType.Self))}catch(e){j(e,s,I.Live)}})(0,s,v||k,a):((e,t,o,s,n)=>async({uri:a,timestamp:r})=>{if(a)try{const n=(null==s?void 0:s.rel_type)===i.THREAD_RELATION_TYPE.name&&(null==s?void 0:s.event_id)||null,l=o===I.Pin?i.LocationAssetType.Pin:i.LocationAssetType.Self,c=i.ContentHelpers.makeLocationContent(void 0,a,r,void 0,l);await(0,U.L)(t,(t=>e.sendMessage(t,n,c)),e)}catch(e){j(e,n,o)}})(m,s,null!=x?x:I.Own,r,a),E=x===I.Live&&!u;return l.createElement(p.ZP,(0,n.Z)({},e,{onFinished:t,managed:!1}),l.createElement("div",{className:"mx_LocationShareMenu"},E&&l.createElement(oe,{onSubmit:()=>{F.C.setValue("feature_location_share_live",null,ne.R.DEVICE,!0)}}),!E&&!!x&&l.createElement(D,{sender:o,shareType:x,onChoose:C,onFinished:t}),!x&&l.createElement(ee,{setShareType:g,enabledShareTypes:d}),l.createElement(W,{displayBack:!!x&&_,onBack:()=>g(void 0),onCancel:t})))},re=({roomId:e,sender:t,menuPosition:o,relation:s})=>{const n=(0,l.useContext)(xe),[a,i,m,u]=(0,p.av)(),_=e=>{u(e),null==n||n()};let h=null;if(a){var x;const n=null!==(x=null!=o?o:i.current&&(0,p.LS)(i.current.getBoundingClientRect()))&&void 0!==x?x:{};h=l.createElement(ae,{menuPosition:n,onFinished:_,sender:t,roomId:e,openMenu:m,relation:s})}const g=r()("mx_MessageComposer_button",{mx_MessageComposer_button_highlight:a});return l.createElement(l.Fragment,null,l.createElement(d.A,{className:g,iconClassName:"mx_MessageComposer_location",onClick:m,title:(0,c._t)("common|location"),inputRef:i}),h)};var ie=o("./node_modules/matrix-react-sdk/src/components/views/elements/PollCreateDialog.tsx"),le=o("./node_modules/matrix-react-sdk/src/MatrixClientPeg.ts"),ce=o("./node_modules/matrix-react-sdk/src/ContentMessages.ts"),me=o("./node_modules/matrix-react-sdk/src/contexts/RoomContext.ts"),de=o("./node_modules/matrix-react-sdk/src/hooks/useDispatcher.ts"),ue=o("./node_modules/matrix-react-sdk/src/utils/BrowserWorkarounds.ts"),_e=o("./node_modules/matrix-react-sdk/src/components/views/context_menus/IconizedContextMenu.tsx"),pe=o("./node_modules/matrix-react-sdk/src/components/views/rooms/EmojiButton.tsx"),he=o("./node_modules/matrix-react-sdk/src/utils/arrays.ts");const xe=(0,l.createContext)(null);function ge(e){return l.createElement(pe.K,{key:"emoji_button",addEmoji:e.addEmoji,menuPosition:e.menuPosition,className:"mx_MessageComposer_button"})}function ve(){return l.createElement(Ee,{key:"controls_upload"})}const ke=(0,l.createContext)(null),Ce=({roomId:e,relation:t,children:o})=>{const s=(0,l.useContext)(h.ZP),n=(0,l.useContext)(me.ZP),a=(0,l.useRef)(null),r=()=>{var e;null!=s&&s.isGuest()?u.ZP.dispatch({action:"require_registration"}):null===(e=a.current)||void 0===e||e.click()};(0,de.P)(u.ZP,(e=>{n.timelineRenderingType===e.context&&"upload_file"===e.action&&r()}));return l.createElement(ke.Provider,{value:r},o,l.createElement("input",{ref:a,type:"file",style:{display:"none"},multiple:!0,onClick:ue.k,onChange:o=>{var a;0!==(null===(a=o.target.files)||void 0===a?void 0:a.length)&&(ce.ZP.sharedInstance().sendContentListToRoom(Array.from(o.target.files),e,t,s,n.timelineRenderingType),o.target.value="")}}))},Ee=()=>{const e=(0,l.useContext)(xe),t=(0,l.useContext)(ke);return l.createElement(d.A,{className:"mx_MessageComposer_button",iconClassName:"mx_MessageComposer_upload",onClick:()=>{null==t||t(),null==e||e()},title:(0,c._t)("common|attachment")})};function ye(e){return e.showStickersButton?l.createElement(d.A,{id:"stickersButton",key:"controls_stickers",className:"mx_MessageComposer_button",iconClassName:"mx_MessageComposer_stickers",onClick:()=>e.setStickerPickerOpen(!e.isStickerPickerOpen),title:e.isStickerPickerOpen?(0,c._t)("composer|close_sticker_picker"):(0,c._t)("common|sticker")}):null}const be=e=>e.showVoiceBroadcastButton?l.createElement(d.A,{key:"start_voice_broadcast",className:"mx_MessageComposer_button",iconClassName:"mx_MessageComposer_voiceBroadcast",onClick:e.onStartVoiceBroadcastClick,title:(0,c._t)("voice_broadcast|action")}):null;function fe(e,t){return t?null:l.createElement(d.A,{key:"voice_message_send",className:"mx_MessageComposer_button",iconClassName:"mx_MessageComposer_voiceMessage",onClick:e.onRecordStartEndClick,title:(0,c._t)("composer|voice_message_button")})}function we(e,t){return l.createElement(Pe,{key:"polls",room:e,relation:t})}class Pe extends l.PureComponent{constructor(...e){super(...e),(0,s.Z)(this,"context",void 0),(0,s.Z)(this,"onCreateClick",(()=>{var e;null===(e=this.context)||void 0===e||e.call(this);if(this.props.room.currentState.maySendEvent(i.M_POLL_START.name,le.p.safeGet().getSafeUserId())){var t;const e=(null===(t=this.props.relation)||void 0===t?void 0:t.rel_type)===i.THREAD_RELATION_TYPE.name?this.props.relation.event_id:void 0;k.ZP.createDialog(ie.Z,{room:this.props.room,threadId:e},"mx_CompoundDialog",!1,!0)}else k.ZP.createDialog(_.Z,{title:(0,c._t)("composer|poll_button_no_perms_title"),description:(0,c._t)("composer|poll_button_no_perms_description")})}))}render(){var e;return(null===(e=this.props.relation)||void 0===e?void 0:e.rel_type)===i.THREAD_RELATION_TYPE.name?null:l.createElement(d.A,{className:"mx_MessageComposer_button",iconClassName:"mx_MessageComposer_poll",onClick:this.onCreateClick,title:(0,c._t)("composer|poll_button")})}}function Se(e,t,o){const s=t.getMember(o.getSafeUserId());return e.showLocationButton&&s?l.createElement(re,{key:"location",roomId:t.roomId,relation:e.relation,sender:s,menuPosition:e.menuPosition}):null}function Me({isRichTextEnabled:e,onClick:t}){const o=e?(0,c._t)("composer|mode_plain"):(0,c._t)("composer|mode_rich_text");return l.createElement(d.A,{className:"mx_MessageComposer_button",iconClassName:r()({mx_MessageComposer_plain_text:!e,mx_MessageComposer_rich_text:e}),onClick:t,title:o})}(0,s.Z)(Pe,"contextType",xe);const Ne=e=>{const t=(0,l.useContext)(h.ZP),{room:o,narrow:s}=(0,l.useContext)(me.ZP),a=(0,se.t)("feature_wysiwyg_composer");if(!t||!o||e.haveRecording)return null;let i,d;s?(i=[a?l.createElement(Me,{key:"composerModeButton",isRichTextEnabled:e.isRichTextEnabled,onClick:e.onComposerModeClick}):ge(e)],d=[ve(),ye(e),fe(e,s),be(e),e.showPollsButton?we(o,e.relation):null,Se(e,o,t)]):(i=[a?l.createElement(Me,{key:"composerModeButton",isRichTextEnabled:e.isRichTextEnabled,onClick:e.onComposerModeClick}):ge(e),ve()],d=[ye(e),fe(e,s),be(e),e.showPollsButton?we(o,e.relation):null,Se(e,o,t)]),i=(0,he.gP)(i),d=(0,he.gP)(d);const u=r()({mx_MessageComposer_button:!0,mx_MessageComposer_buttonMenu:!0,mx_MessageComposer_closeButtonMenu:e.isMenuOpen});return l.createElement(Ce,{roomId:o.roomId,relation:e.relation},i,d.length>0&&l.createElement(m.Z,{className:u,onClick:e.toggleButtonMenu,title:(0,c._t)("quick_settings|sidebar_settings")}),e.isMenuOpen&&l.createElement(_e.ZP,(0,n.Z)({onFinished:e.toggleButtonMenu},e.menuPosition,{wrapperClassName:"mx_MessageComposer_Menu",compact:!0}),l.createElement(xe.Provider,{value:e.toggleButtonMenu},l.createElement(_e.I2,null,d))))}},"./node_modules/matrix-react-sdk/src/stores/OwnProfileStore.ts":(e,t,o)=>{o.d(t,{p:()=>p});var s,n=o("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=o("./node_modules/matrix-js-sdk/src/matrix.ts"),r=o("./node_modules/lodash/lodash.js"),i=o("./node_modules/matrix-react-sdk/src/stores/AsyncStoreWithClient.ts"),l=o("./node_modules/matrix-react-sdk/src/dispatcher/dispatcher.ts"),c=o("./node_modules/matrix-react-sdk/src/MatrixClientPeg.ts"),m=o("./node_modules/matrix-react-sdk/src/languageHandler.tsx"),d=o("./node_modules/matrix-react-sdk/src/customisations/Media.ts");const u="mx_profile_displayname",_="mx_profile_avatar_url";class p extends i._{constructor(){super(l.ZP,{displayName:window.localStorage.getItem(u)||void 0,avatarUrl:window.localStorage.getItem(_)||void 0}),(0,n.Z)(this,"monitoredUser",null),(0,n.Z)(this,"onProfileUpdate",(0,r.throttle)((async()=>{if(!this.matrixClient)return;let e={displayname:void 0,avatar_url:void 0};try{e=await this.matrixClient.getProfileInfo(this.matrixClient.getSafeUserId())}catch(e){if(!(e instanceof a.MatrixError)||"M_NOT_FOUND"!==e.errcode)throw e}e.displayname?window.localStorage.setItem(u,e.displayname):window.localStorage.removeItem(u),e.avatar_url?window.localStorage.setItem(_,e.avatar_url):window.localStorage.removeItem(_),await this.updateState({displayName:e.displayname,avatarUrl:e.avatar_url,fetchedAt:Date.now()})}),200,{trailing:!0,leading:!0})),(0,n.Z)(this,"onStateEvents",(async e=>{const t=c.p.safeGet().getUserId();e.getType()===a.EventType.RoomMember&&e.getSender()===t&&e.getStateKey()===t&&await this.onProfileUpdate()}))}static get instance(){return p.internalInstance}get displayName(){return this.matrixClient?this.matrixClient.isGuest()?(0,m._t)("common|guest"):this.state.displayName?this.state.displayName:this.matrixClient.getUserId():this.state.displayName||null}get isProfileInfoFetched(){return!!this.state.fetchedAt}get avatarMxc(){return this.state.avatarUrl||null}getHttpAvatarUrl(e=0){if(!this.avatarMxc)return null;const t=(0,d.TS)(this.avatarMxc);return!e||e<=0?t.srcHttp:t.getSquareThumbnailHttp(e)}async onNotReady(){var e;this.onProfileUpdate.cancel(),this.monitoredUser&&(this.monitoredUser.removeListener(a.UserEvent.DisplayName,this.onProfileUpdate),this.monitoredUser.removeListener(a.UserEvent.AvatarUrl,this.onProfileUpdate)),null===(e=this.matrixClient)||void 0===e||e.removeListener(a.RoomStateEvent.Events,this.onStateEvents),await this.reset({})}async onReady(){if(!this.matrixClient)return;const e=this.matrixClient.getSafeUserId();this.monitoredUser=this.matrixClient.getUser(e),this.monitoredUser&&(this.monitoredUser.on(a.UserEvent.DisplayName,this.onProfileUpdate),this.monitoredUser.on(a.UserEvent.AvatarUrl,this.onProfileUpdate)),this.matrixClient.on(a.RoomStateEvent.Events,this.onStateEvents),await this.onProfileUpdate()}async onAction(e){}}s=p,(0,n.Z)(p,"internalInstance",(()=>{const e=new s;return e.start(),e})())}}]);
//# sourceMappingURL=230.js.map