(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{1288:function(t,e,n){"use strict";e.a=n.p+"i18n/languages.8cc7d18.json"},1290:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return c}));var a=n(17),i=n.n(a);function s(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?s(Object(n),!0).forEach((function(e){i()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}const r={bgColor:"#d00",textColor:"#fff",fontFamily:"sans-serif",fontWeight:"bold",isUp:!1,isLeft:!1};class c{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i()(this,"browser",{ff:void 0!==window.InstallTrigger,opera:!!window.opera||navigator.userAgent.includes("Opera")}),i()(this,"params",void 0),i()(this,"canvas",void 0),i()(this,"baseImage",void 0),i()(this,"context",void 0),i()(this,"icons",void 0),i()(this,"isReady",!1),i()(this,"readyCb",()=>{}),this.params=o(o({},r),t),this.icons=c.getIcons(),this.canvas=document.createElement("canvas"),this.baseImage=document.createElement("img");const e=this.icons[this.icons.length-1];e.hasAttribute("href")?(this.baseImage.setAttribute("crossOrigin","anonymous"),this.baseImage.onload=()=>{this.canvas.height=this.baseImage.height>0?this.baseImage.height:32,this.canvas.width=this.baseImage.width>0?this.baseImage.width:32,this.context=this.canvas.getContext("2d"),this.ready()},this.baseImage.setAttribute("src",e.getAttribute("href"))):(this.canvas.height=this.baseImage.height=32,this.canvas.width=this.baseImage.width=32,this.context=this.canvas.getContext("2d"),this.ready())}reset(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.drawImage(this.baseImage,0,0,this.canvas.width,this.canvas.height)}options(t,e){const n={n:"number"==typeof t?Math.abs(t):t,len:(""+t).length,x:.4,y:.4,w:.6,h:.6};return e.isUp&&(n.y<.6?n.y=n.y-.4:n.y=n.y-2*n.y+(1-n.w)),e.isLeft&&(n.x<.6?n.x=n.x-.4:n.x=n.x-2*n.x+(1-n.h)),n.x=this.canvas.width*n.x,n.y=this.canvas.height*n.y,n.w=this.canvas.width*n.w,n.h=this.canvas.height*n.h,n}circle(t,e){const n=o(o({},this.params),e),a=this.options(t,n);let i=!1;2===a.len?(a.x=a.x-.4*a.w,a.w=1.4*a.w,i=!0):a.len>=3&&(a.x=a.x-.65*a.w,a.w=1.65*a.w,i=!0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.drawImage(this.baseImage,0,0,this.canvas.width,this.canvas.height),this.context.beginPath();const s=Math.floor(a.h*(a.n>99?.85:1))+"px";if(this.context.font=`${n.fontWeight} ${s} ${n.fontFamily}`,this.context.textAlign="center",i?(this.context.moveTo(a.x+a.w/2,a.y),this.context.lineTo(a.x+a.w-a.h/2,a.y),this.context.quadraticCurveTo(a.x+a.w,a.y,a.x+a.w,a.y+a.h/2),this.context.lineTo(a.x+a.w,a.y+a.h-a.h/2),this.context.quadraticCurveTo(a.x+a.w,a.y+a.h,a.x+a.w-a.h/2,a.y+a.h),this.context.lineTo(a.x+a.h/2,a.y+a.h),this.context.quadraticCurveTo(a.x,a.y+a.h,a.x,a.y+a.h-a.h/2),this.context.lineTo(a.x,a.y+a.h/2),this.context.quadraticCurveTo(a.x,a.y,a.x+a.h/2,a.y)):this.context.arc(a.x+a.w/2,a.y+a.h/2,a.h/2,0,2*Math.PI),this.context.fillStyle=n.bgColor,this.context.fill(),this.context.closePath(),this.context.beginPath(),this.context.stroke(),this.context.fillStyle=n.textColor,"number"==typeof a.n&&a.n>999){const t=(a.n>9999?9:Math.floor(a.n/1e3))+"k+";this.context.fillText(t,Math.floor(a.x+a.w/2),Math.floor(a.y+a.h-.2*a.h))}else this.context.fillText(""+a.n,Math.floor(a.x+a.w/2),Math.floor(a.y+a.h-.15*a.h));this.context.closePath()}ready(){this.isReady||(this.isReady=!0,this.readyCb())}setIcon(e){t(()=>{this.setIconSrc(e.toDataURL("image/png"))})}setIconSrc(t){if(this.browser.ff||this.browser.opera){const e=this.icons[this.icons.length-1],n=window.document.createElement("link");this.icons=[n],n.setAttribute("rel","icon"),n.setAttribute("type","image/png"),window.document.getElementsByTagName("head")[0].appendChild(n),n.setAttribute("href",t),e.parentNode&&e.parentNode.removeChild(e)}else this.icons.forEach(e=>{e.setAttribute("href",t)})}badge(t,e){this.isReady?("string"==typeof t||t>0?this.circle(t,e):this.reset(),this.setIcon(this.canvas)):this.readyCb=()=>{this.badge(t,e)}}static getLinks(){const t=[],e=window.document.getElementsByTagName("head")[0].getElementsByTagName("link");for(let n=0;n<e.length;n++)/(^|\s)icon(\s|$)/i.test(e[n].getAttribute("rel"))&&t.push(e[n]);return t}static getIcons(){let t=c.getLinks();return 0===t.length&&(t=[window.document.createElement("link")],t[0].setAttribute("rel","icon"),window.document.getElementsByTagName("head")[0].appendChild(t[0])),t.forEach(t=>{t.setAttribute("type","image/png")}),t}}}).call(this,n(183).setImmediate)},461:function(t,e){},462:function(t,e){},6:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var a=n(5),i=n.n(a);async function s(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";""===t||t.endsWith("/")||(t+="/");const e=o(`${t}config.${document.domain}.json`),n=o(t+"config.json");try{const t=await e;if(0===Object.keys(t).length)throw new Error;return t}catch(t){return await n}}function o(t){return new Promise((function(e,n){i()({method:"GET",url:t,qs:{cachebuster:Date.now()}},(t,a,i)=>{try{if(t||a.status<200||a.status>=300)return a&&(404==a.status||0==a.status&&""==i)&&e({}),void n({err:t,response:a});e(JSON.parse(i))}catch(t){n({err:t})}})}))}},638:function(t,e){},642:function(t,e){},86:function(t,e,n){"use strict";n.r(e),n.d(e,"rageshakePromise",(function(){return X})),n.d(e,"preparePlatform",(function(){return Y})),n.d(e,"setupLogStorage",(function(){return Z})),n.d(e,"loadConfig",(function(){return tt})),n.d(e,"loadOlm",(function(){return et})),n.d(e,"loadLanguage",(function(){return nt})),n.d(e,"loadTheme",(function(){return at})),n.d(e,"loadApp",(function(){return it})),n.d(e,"showError",(function(){return st})),n.d(e,"showIncompatibleBrowser",(function(){return ot})),n.d(e,"_t",(function(){return rt}));var a=n(811),i=n(812),s=n.n(i),o=n(150),r=n(87),c=n.n(r),l=n(88),d=n(92),u=n(127),h=n(97),p=n(265),g=n(0),w=n(17),f=n.n(w),m=n(299),y=n(91),b=n(494),v=n(94),x=n(209),O=n(101),C=n(187),I=n(95),k=n(554),S=n(168),E=n(1289),j=n(6),P=n(1290);class D extends m.e{constructor(){super(...arguments),f()(this,"_favicon",void 0)}async getConfig(){return Object(j.a)()}getHumanReadableName(){return"Vector Base Platform"}get favicon(){return this._favicon?this._favicon:this._favicon=new P.a}updateFavicon(){let t="#d00",e=this.notificationCount;this.errorDidOccur&&(e=e||"×",t="#f00"),this.favicon.badge(e,{bgColor:t})}setNotificationCount(t){this.notificationCount!==t&&(super.setNotificationCount(t),this.updateFavicon())}setErrorStatus(t){this.errorDidOccur!==t&&(super.setErrorStatus(t),this.updateFavicon())}startUpdater(){}getDefaultDeviceDisplayName(){return Object(l.a)("Unknown device")}}var U=n(1291),N=n(7);const A=window.electron;class L{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ipcCall",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ipcReply";this.sendChannel=t,this.recvChannel=e,f()(this,"pendingIpcCalls",{}),f()(this,"nextIpcCallId",0),f()(this,"onIpcReply",(t,e)=>{if(void 0===e.id)return void g.a.warn("Ignoring IPC reply with no ID");if(void 0===this.pendingIpcCalls[e.id])return void g.a.warn("Unknown IPC payload ID: "+e.id);const n=this.pendingIpcCalls[e.id];delete this.pendingIpcCalls[e.id],e.error?n.reject(e.error):n.resolve(e.reply)}),A.on(this.recvChannel,this.onIpcReply)}async call(t){const e=++this.nextIpcCallId,n=Object(N.l)();this.pendingIpcCalls[e]=n;for(var a=arguments.length,i=new Array(a>1?a-1:0),s=1;s<a;s++)i[s-1]=arguments[s];return window.electron.send(this.sendChannel,{id:e,name:t,args:i}),n.promise}}class T extends U.a{constructor(){super(...arguments),f()(this,"ipc",new L("seshat","seshatReply"))}async supportsEventIndexing(){return this.ipc.call("supportsEventIndexing")}async initEventIndex(t,e){return this.ipc.call("initEventIndex",t,e)}async addEventToIndex(t,e){return this.ipc.call("addEventToIndex",t,e)}async deleteEvent(t){return this.ipc.call("deleteEvent",t)}async isEventIndexEmpty(){return this.ipc.call("isEventIndexEmpty")}async isRoomIndexed(t){return this.ipc.call("isRoomIndexed",t)}async commitLiveEvents(){return this.ipc.call("commitLiveEvents")}async searchEventIndex(t){return this.ipc.call("searchEventIndex",t)}async addHistoricEvents(t,e,n){return this.ipc.call("addHistoricEvents",t,e,n)}async addCrawlerCheckpoint(t){return this.ipc.call("addCrawlerCheckpoint",t)}async removeCrawlerCheckpoint(t){return this.ipc.call("removeCrawlerCheckpoint",t)}async loadFileEvents(t){return this.ipc.call("loadFileEvents",t)}async loadCheckpoints(){return this.ipc.call("loadCheckpoints")}async closeEventIndex(){return this.ipc.call("closeEventIndex")}async getStats(){return this.ipc.call("getStats")}async getUserVersion(){return this.ipc.call("getUserVersion")}async setUserVersion(t){return this.ipc.call("setUserVersion",t)}async deleteEventIndex(){return this.ipc.call("deleteEventIndex")}}function B(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}const R=window.electron,F=navigator.platform.toUpperCase().includes("MAC");function _(t){["call_state"].includes(t.action)&&R.send("app_onAction",t)}class M extends D{constructor(){super(),f()(this,"ipc",new L("ipcCall","ipcReply")),f()(this,"eventIndexManager",new T),f()(this,"ssoID",Object(C.b)(32)),f()(this,"onUpdateDownloaded",async(t,e)=>{let{releaseNotes:n,releaseName:a}=e;y.a.dispatch({action:I.a.CheckUpdates,status:m.d.Ready}),this.shouldShowUpdate(a)&&Object(k.b)(await this.getAppVersion(),a,n)}),y.a.register(_),R.on("check_updates",(t,e)=>{y.a.dispatch(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?B(Object(n),!0).forEach((function(e){f()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({action:I.a.CheckUpdates},function(t){return!0===t?{status:m.d.Downloading}:!1===t?{status:m.d.NotAvailable}:{status:m.d.Error,detail:t}}(e)))}),R.on("before-quit",(function(){g.a.log("element-desktop closing"),b.b()})),R.on("update-downloaded",this.onUpdateDownloaded),R.on("preferences",()=>{y.a.fire(I.a.ViewUserSettings)}),R.on("userDownloadCompleted",(t,e)=>{let{id:n,name:a}=e;const i="DOWNLOAD_TOAST_"+n;S.a.sharedInstance().addOrReplaceToast({key:i,title:Object(l.a)("Download Completed"),props:{description:a,acceptLabel:Object(l.a)("Open"),onAccept:()=>{R.send("userDownloadAction",{id:n,open:!0}),S.a.sharedInstance().dismissToast(i)},dismissLabel:Object(l.a)("Dismiss"),onDismiss:()=>{R.send("userDownloadAction",{id:n})},numSeconds:10},component:E.a,priority:99})}),this.ipc.call("startSSOFlow",this.ssoID)}async getConfig(){return this.ipc.call("getConfig")}getHumanReadableName(){return"Electron Platform"}supportsMultiLanguageSpellCheck(){return!F}allowOverridingNativeContextMenus(){return!0}setNotificationCount(t){this.notificationCount!==t&&(super.setNotificationCount(t),R.send("setBadgeCount",t))}supportsNotifications(){return!0}maySendNotifications(){return!0}displayNotification(t,e,n,a,i){navigator.userAgent.includes("Linux")&&(e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;"));const s=super.displayNotification(t,e,n,a,i),o=s.onclick;return s.onclick=()=>{null==o||o(),this.ipc.call("focusWindow")},s}loudNotification(t,e){R.send("loudNotification")}async getAppVersion(){return this.ipc.call("getAppVersion")}supportsSetting(t){switch(t){case"Electron.showTrayIcon":case"Electron.alwaysShowMenuBar":return!F;default:return!0}}getSettingValue(t){return this.ipc.call("getSettingValue",t)}setSettingValue(t,e){return this.ipc.call("setSettingValue",t,e)}async canSelfUpdate(){const t=await this.ipc.call("getUpdateFeedUrl");return Boolean(t)}startUpdateCheck(){super.startUpdateCheck(),R.send("check_updates")}installUpdate(){R.send("install_update")}getDefaultDeviceDisplayName(){const t=h.b.get().brand;return Object(l.a)("%(brand)s Desktop (%(platformName)s)",{brand:t,platformName:navigator.userAgent.includes("Macintosh")?"macOS":navigator.userAgent.includes("FreeBSD")?"FreeBSD":navigator.userAgent.includes("OpenBSD")?"OpenBSD":navigator.userAgent.includes("SunOS")?"SunOS":navigator.userAgent.includes("Windows")?"Windows":navigator.userAgent.includes("Linux")?"Linux":"Unknown"})}requestNotificationPermission(){return Promise.resolve("granted")}reload(){window.location.reload()}getEventIndexingManager(){return this.eventIndexManager}async setLanguage(t){return this.ipc.call("setLanguage",t)}setSpellCheckLanguages(t){this.ipc.call("setSpellCheckLanguages",t).catch(t=>{g.a.log("Failed to send setSpellCheckLanguages IPC to Electron"),g.a.error(t)})}async getSpellCheckLanguages(){return this.ipc.call("getSpellCheckLanguages")}async getDesktopCapturerSources(t){return this.ipc.call("getDesktopCapturerSources",t)}supportsDesktopCapturer(){return!0}async getAvailableSpellCheckLanguages(){return this.ipc.call("getAvailableSpellCheckLanguages")}getSSOCallbackUrl(t){const e=super.getSSOCallbackUrl(t);return e.protocol="element",e.searchParams.set("element-desktop-ssoid",this.ssoID),e}startSingleSignOn(t,e,n,a){super.startSingleSignOn(t,e,n,a),v.a.createDialog(x.a,{title:Object(l.a)("Go to your browser to complete Sign In"),description:c.a.createElement(O.a,null)})}navigateForwardBack(t){this.ipc.call(t?"navigateBack":"navigateForward")}overrideBrowserShortcuts(){return!0}async getPickleKey(t,e){try{return await this.ipc.call("getPickleKey",t,e)}catch(t){return null}}async createPickleKey(t,e){try{return await this.ipc.call("createPickleKey",t,e)}catch(t){return null}}async destroyPickleKey(t,e){try{await this.ipc.call("destroyPickleKey",t,e)}catch(t){}}}var V=n(5),W=n.n(V),q=n(1292),$=n.n(q),K=n(26);function H(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function G(t){return/^v\d+.\d+.\d+(-.+)?$/.test(t)?t.substring(1):t}class J extends D{constructor(){super(),f()(this,"pollForUpdate",(t,e)=>this.getMostRecentVersion().then(n=>{const a=G("v1.11.0");return a!==n?(this.shouldShowUpdate(n)?(console.log("Update available to "+n+", will notify user"),t(a,n)):console.log("Update available to "+n+" but won't be shown"),{status:m.d.Ready}):(console.log("No update available, already on "+n),null==e||e(),{status:m.d.NotAvailable})},t=>(g.a.error("Failed to poll for update",t),{status:m.d.Error,detail:t.message||t.status?t.status.toString():"Unknown Error"}))),"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js")}getHumanReadableName(){return"Web Platform"}supportsNotifications(){return Boolean(window.Notification)}maySendNotifications(){return"granted"===window.Notification.permission}requestNotificationPermission(){return new Promise((function(t,e){window.Notification.requestPermission(e=>{t(e)})}))}getMostRecentVersion(){return new Promise((t,e)=>{W()({method:"GET",url:"version",qs:{cachebuster:Date.now()}},(n,a,i)=>{if(n||a.status<200||a.status>=300)return null===n&&(n={status:a.status}),void e(n);t(G(i.trim()))})})}getAppVersion(){return Promise.resolve(G("v1.11.0"))}startUpdater(){console.log("startUpdater, current version is "+G("v1.11.0")),this.pollForUpdate((t,e)=>{if(Object(K.a)(location).updated)return console.log("Update reloaded but still on an old version, stopping"),void Object(k.b)(t,e);const n=new URL(window.location.href);n.searchParams.set("updated",e),console.log("Update reloading to "+n.toString()),window.location.href=n.toString()}),setInterval(()=>this.pollForUpdate(k.b,k.a),6e5)}async canSelfUpdate(){return!0}startUpdateCheck(){super.startUpdateCheck(),this.pollForUpdate(k.b,k.a).then(t=>{y.a.dispatch(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?H(Object(n),!0).forEach((function(e){f()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):H(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({action:I.a.CheckUpdates},t))})}installUpdate(){window.location.reload()}getDefaultDeviceDisplayName(){const t=new URL(window.location.href),e=[t.host,t.pathname.replace(/\/$/,"")].join(""),n=new $.a,a=n.getBrowser().name||"unknown browser";let i=n.getOS().name||"unknown OS";return"Mac OS"===i&&(i="macOS"),Object(l.a)("%(appName)s (%(browserName)s, %(osName)s)",{appName:e,browserName:a,osName:i})}reload(){window.location.reload()}}class z extends J{setNotificationCount(t){if(!navigator.setAppBadge)return super.setNotificationCount(t);this.notificationCount!==t&&(this.notificationCount=t,navigator.setAppBadge(t).catch(t=>{g.a.error("Failed to update PWA app badge",t)}))}}var Q=n(327);window.mxSendRageshake=function(t,e){const n=h.b.get().bug_report_endpoint_url;n?(void 0===e&&(e=!0),t&&t.trim()?Object(Q.a)(n,{userText:t,sendLogs:e,progressCallback:g.a.log.bind(console)}).then(()=>{g.a.log("Bug report sent!")},t=>{g.a.error(t)}):g.a.error("Cannot send a rageshake without a message - please tell us what went wrong")):g.a.error("Cannot send a rageshake - no bug_report_endpoint_url configured")};const X=function(){const t=b.d(!1);return t.then(()=>{g.a.log("Initialised rageshake."),g.a.log("To fix line numbers in Chrome: Meatball menu → Settings → Ignore list → Add /rageshake\\.js$"),window.addEventListener("beforeunload",t=>{g.a.log("element-web closing"),b.b()}),b.a()},t=>{g.a.error("Failed to initialise rageshake: "+t)}),t}();function Y(){window.electron?(g.a.log("Using Electron platform"),u.a.set(new M)):window.matchMedia("(display-mode: standalone)").matches?(g.a.log("Using PWA platform"),u.a.set(new z)):(g.a.log("Using Web platform"),u.a.set(new J))}function Z(){return h.b.get().bug_report_endpoint_url?b.e():(g.a.warn("No bug report endpoint set - logs will not be persisted"),Promise.resolve())}async function tt(){const t=await u.a.get().getConfig();t?h.b.put(t):h.b.unset()}function et(){return s.a.init({locateFile:()=>a.a}).then(()=>{g.a.log("Using WebAssembly Olm")}).catch(t=>(g.a.log("Failed to load Olm: trying legacy version",t),new Promise((t,e)=>{const n=document.createElement("script");n.src="olm_legacy.js",n.onload=t,n.onerror=e,document.body.appendChild(n)}).then(()=>window.Olm.init()).then(()=>{g.a.log("Using legacy Olm")}).catch(t=>{g.a.log("Both WebAssembly and asm.js Olm failed!",t)})))}async function nt(){const t=d.b.getValue("language",null,!0);let e=[];t?e=[t]:l.f().forEach(t=>{e.push(...l.g(t))});try{await l.l(e),document.documentElement.setAttribute("lang",l.e())}catch(t){g.a.error("Unable to set language",t)}}async function at(){Object(p.h)()}async function it(t){const e=await Promise.all([n.e(17),n.e(26),n.e(12)]).then(n.bind(null,1423));window.matrixChat=o.render(await e.loadApp(t),document.getElementById("matrixchat"))}async function st(t,e){const a=(await n.e(13).then(n.bind(null,1418))).default;window.matrixChat=o.render(r.createElement(a,{title:t,messages:e}),document.getElementById("matrixchat"))}async function ot(t){const e=(await n.e(11).then(n.bind(null,1419))).default;window.matrixChat=o.render(r.createElement(e,{onAccept:t}),document.getElementById("matrixchat"))}const rt=l.a},975:function(t,e){}}]);
//# sourceMappingURL=init.js.map